sequenceDiagram
    autonumber
    participant Client as MCP 호환 클라이언트<br/>(예: Cursor, Claude)
    participant MCP as MCP 서버<br/>(Controller / Service)
    participant API as Spring Boot(api)
    participant APP as Spring Boot(application)
    participant INF as Spring Boot(infra)
    participant PDP as 공공데이터 포털 API

    Client->>MCP: JSON-RPC STDIO 요청<br/>{ "method": "tools/call",<br/> "params": { "name": "public_data.search", "arguments": {"query": "서울 날씨"} } }
    MCP->>API: REST 요청 /api/public-data?query=서울+날씨
    API->>APP: 유스케이스 실행(검증/권한/로깅)
    APP->>INF: 외부 연동 호출 준비(캐시 확인, 헤더/키 세팅)

    alt 캐시 히트
        INF-->>APP: 캐시 데이터 반환
    else 캐시 미스
        INF->>PDP: 공공데이터 포털 REST 호출
        PDP-->>INF: 원본 응답(JSON/XML)
        INF->>INF: 변환/파싱(JSON/XML → 내부 DTO)
        INF->>INF: 캐시 저장(선택)
        INF-->>APP: 외부 응답 DTO 반환
    end

    APP->>APP: 추가 가공/정합성 체크/필드 매핑
    APP-->>API: API 응답 DTO
    API-->>MCP: 결과(JSON) (상태/메시지/데이터)
    MCP->>MCP: Tool 핸들러에서 최종 메시지 생성
    MCP-->>Client: MCP Tool 결과 응답(요약/테이블 등)
